<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NYSE Market Status</title>
    <style>
        :root {
            --color-cream-50: rgba(252, 252, 249, 1);
            --color-cream-100: rgba(255, 255, 253, 1);
            --color-gray-200: rgba(245, 245, 245, 1);
            --color-slate-500: rgba(98, 108, 113, 1);
            --color-slate-900: rgba(19, 52, 59, 1);
            --color-charcoal-700: rgba(31, 33, 33, 1);
            --color-charcoal-800: rgba(38, 40, 40, 1);
            --color-teal-300: rgba(50, 184, 198, 1);
            --color-teal-500: rgba(33, 128, 141, 1);
            --color-teal-600: rgba(29, 116, 128, 1);
            --color-red-400: rgba(255, 84, 89, 1);
            --color-red-500: rgba(192, 21, 47, 1);
            --color-orange-400: rgba(230, 129, 97, 1);
            --color-brown-600-rgb: 94, 82, 64;
            --color-teal-500-rgb: 33, 128, 141;
            --color-slate-900-rgb: 19, 52, 59;
            --color-gray-400-rgb: 119, 124, 124;
            
            --color-background: var(--color-cream-50);
            --color-surface: var(--color-cream-100);
            --color-text: var(--color-slate-900);
            --color-text-secondary: var(--color-slate-500);
            --color-primary: var(--color-teal-500);
            --color-border: rgba(var(--color-brown-600-rgb), 0.2);
            --color-success: var(--color-teal-500);
            --color-error: var(--color-red-500);
            --color-warning: var(--color-orange-400);
            
            --font-family-base: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --font-size-sm: 12px;
            --font-size-base: 14px;
            --font-size-lg: 16px;
            --font-size-xl: 18px;
            --font-size-2xl: 20px;
            --font-size-3xl: 24px;
            --font-size-4xl: 30px;
            --space-12: 12px;
            --space-16: 16px;
            --space-20: 20px;
            --space-24: 24px;
            --radius-lg: 12px;
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: var(--color-charcoal-700);
                --color-surface: var(--color-charcoal-800);
                --color-text: var(--color-gray-200);
                --color-text-secondary: rgba(167, 169, 169, 0.7);
                --color-primary: var(--color-teal-300);
                --color-border: rgba(var(--color-gray-400-rgb), 0.3);
                --color-success: var(--color-teal-300);
                --color-error: var(--color-red-400);
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-background);
            color: var(--color-text);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: var(--space-20);
        }

        .widget {
            background: var(--color-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
            box-shadow: var(--shadow-md);
            padding: 14px;
            max-width: 320px;
            width: 100%;
        }

        .status-header {
            text-align: center;
            margin-bottom: 12px;
        }

        .market-name {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: var(--space-12);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 9999px;
            font-weight: 600;
            font-size: var(--font-size-lg);
            margin-bottom: var(--space-12);
        }

        .status-badge.open {
            background: rgba(var(--color-teal-500-rgb), 0.15);
            color: var(--color-success);
            border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
        }

        .status-badge.closed {
            background: rgba(192, 21, 47, 0.15);
            color: var(--color-error);
            border: 1px solid rgba(192, 21, 47, 0.25);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-badge.open .status-dot {
            background: var(--color-success);
        }

        .status-badge.closed .status-dot {
            background: var(--color-error);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .countdown {
            text-align: center;
            padding: 12px;
            background: var(--color-background);
            border-radius: var(--radius-lg);
            margin-bottom: 12px;
        }

        .countdown-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: 6px;
        }

        .countdown-time {
            font-size: var(--font-size-3xl);
            font-weight: 600;
            color: var(--color-text);
            font-variant-numeric: tabular-nums;
            margin-bottom: 8px;
        }

        .countdown-next {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .info-grid {
            display: grid;
            gap: 0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px var(--space-12);
            background: var(--color-background);
            border-radius: 8px;
            font-size: var(--font-size-sm);
        }

        .info-label {
            color: var(--color-text-secondary);
        }

        .info-value {
            font-weight: 500;
            color: var(--color-text);
        }

        .footer-note {
            margin-top: var(--space-16);
            padding-top: var(--space-16);
            border-top: 1px solid var(--color-border);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="widget">
        <div class="status-header">
            <div class="market-name">New York Stock Exchange</div>
            <div id="statusBadge" class="status-badge">
                <span class="status-dot"></span>
                <span id="statusText">Checking...</span>
            </div>
        </div>

        <div class="countdown">
            <div class="countdown-label" id="countdownLabel">Time Until Open</div>
            <div class="countdown-time" id="countdownTime">--:--:--</div>
            <div class="countdown-next" id="nextSession">--</div>
        </div>

        <div class="info-grid">
            <div class="info-row">
                <span class="info-label">Market Hours (Local Time)</span>
                <span class="info-value" id="marketHoursLocal">--</span>
            </div>
        </div>
    </div>

    <script>
        // NYSE holidays for 2026
        const holidays2026 = [
            '2026-01-01', // New Year's Day
            '2026-01-19', // MLK Day
            '2026-02-16', // President's Day
            '2026-04-03', // Good Friday
            '2026-05-25', // Memorial Day
            '2026-06-19', // Juneteenth
            '2026-07-03', // Independence Day (observed)
            '2026-09-07', // Labor Day
            '2026-11-26', // Thanksgiving
            '2026-12-25'  // Christmas
        ];

        // Early close days (1:00 PM)
        const earlyCloseDays2026 = [
            '2026-11-27', // Day after Thanksgiving
            '2026-12-24'  // Christmas Eve
        ];

        function isHoliday(date) {
            const dateStr = date.toISOString().split('T')[0];
            return holidays2026.includes(dateStr);
        }

        function isEarlyClose(date) {
            const dateStr = date.toISOString().split('T')[0];
            return earlyCloseDays2026.includes(dateStr);
        }

        function getMarketHours(date) {
            const openHour = 9;
            const openMinute = 30;
            const closeHour = isEarlyClose(date) ? 13 : 16;
            const closeMinute = isEarlyClose(date) ? 0 : 0;

            return { openHour, openMinute, closeHour, closeMinute };
        }

        function isMarketOpen(now) {
            const day = now.getDay();
            
            // Weekend
            if (day === 0 || day === 6) return false;
            
            // Holiday
            if (isHoliday(now)) return false;

            const hours = now.getHours();
            const minutes = now.getMinutes();
            const { openHour, openMinute, closeHour, closeMinute } = getMarketHours(now);

            const currentMinutes = hours * 60 + minutes;
            const openMinutes = openHour * 60 + openMinute;
            const closeMinutes = closeHour * 60 + closeMinute;

            return currentMinutes >= openMinutes && currentMinutes < closeMinutes;
        }

        // Generate all trading days for 2026
        function generateTradingDays() {
            const tradingDays = [];
            const year = 2026;
            
            for (let month = 0; month < 12; month++) {
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dayOfWeek = date.getDay();
                    
                    // Skip weekends
                    if (dayOfWeek === 0 || dayOfWeek === 6) continue;
                    
                    // Skip holidays
                    if (isHoliday(date)) continue;
                    
                    tradingDays.push(date);
                }
            }
            
            return tradingDays;
        }

        const TRADING_DAYS_2026 = generateTradingDays();

        function getNextMarketOpen(now) {
            const currentDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const openMinutes = 9 * 60 + 30; // 9:30 AM
            
            // Find the next trading day
            for (let i = 0; i < TRADING_DAYS_2026.length; i++) {
                const tradingDay = TRADING_DAYS_2026[i];
                
                // If this trading day is today and we're before market open
                if (tradingDay.getTime() === currentDate.getTime() && currentMinutes < openMinutes) {
                    const nextOpen = new Date(tradingDay);
                    nextOpen.setHours(9, 30, 0, 0);
                    return nextOpen;
                }
                
                // If this trading day is after today
                if (tradingDay > currentDate) {
                    const nextOpen = new Date(tradingDay);
                    nextOpen.setHours(9, 30, 0, 0);
                    return nextOpen;
                }
            }
            
            // Fallback (shouldn't happen in 2026)
            const fallback = new Date(now);
            fallback.setDate(fallback.getDate() + 1);
            fallback.setHours(9, 30, 0, 0);
            return fallback;
        }

        function getNextMarketClose(now) {
            let close = new Date(now);
            const { closeHour, closeMinute } = getMarketHours(close);
            close.setHours(closeHour, closeMinute, 0, 0);
            return close;
        }

        function formatCountdown(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function formatTime(date) {
            return date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true,
                timeZone: 'America/New_York'
            });
        }

        function formatDate(date) {
            const options = {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            };
            const formatter = new Intl.DateTimeFormat('en-US', options);
            return formatter.format(date);
        }

        function getLocalMarketHours() {
            // Create a date in ET timezone for 9:30 AM
            const openETString = new Date().toLocaleString('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
            
            // Parse to create dates in ET
            const [month, day, year] = openETString.split(/[\s,\/]+/).filter(x => x);
            const openET = new Date(`${year}-${month}-${day}T09:30:00-05:00`); // EST
            const closeET = new Date(`${year}-${month}-${day}T16:00:00-05:00`); // EST
            
            // Format in user's local timezone (automatically detected from browser)
            const timeFormat = {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            };
            
            const openLocal = openET.toLocaleTimeString('en-US', timeFormat);
            const closeLocal = closeET.toLocaleTimeString('en-US', timeFormat);
            
            return `${openLocal} - ${closeLocal}`;
        }

        function updateWidget() {
            const now = new Date();
            
            // Convert to ET timezone properly
            const etFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            
            const parts = {};
            etFormatter.formatToParts(now).forEach(part => {
                parts[part.type] = part.value;
            });
            
            // Create proper ET date
            const etNow = new Date(`${parts.year}-${parts.month}-${parts.day}T${parts.hour}:${parts.minute}:${parts.second}`);

            const statusBadge = document.getElementById('statusBadge');
            const statusText = document.getElementById('statusText');
            const countdownLabel = document.getElementById('countdownLabel');
            const countdownTime = document.getElementById('countdownTime');
            const currentTime = document.getElementById('currentTime');
            const nextSession = document.getElementById('nextSession');
            const marketHoursLocal = document.getElementById('marketHoursLocal');

            marketHoursLocal.textContent = getLocalMarketHours();

            if (isMarketOpen(etNow)) {
                statusBadge.className = 'status-badge open';
                statusText.textContent = 'OPEN';
                
                const nextClose = getNextMarketClose(etNow);
                const timeUntilClose = nextClose - etNow;
                
                countdownLabel.textContent = 'Time Until Close';
                countdownTime.textContent = formatCountdown(timeUntilClose);
                
                nextSession.textContent = `Closes at ${formatTime(nextClose)}`;
            } else {
                statusBadge.className = 'status-badge closed';
                statusText.textContent = 'CLOSED';
                
                const nextOpen = getNextMarketOpen(etNow);
                const timeUntilOpen = nextOpen - etNow;
                
                countdownLabel.textContent = 'Time Until Open';
                countdownTime.textContent = formatCountdown(timeUntilOpen);
                
                nextSession.textContent = `${formatDate(nextOpen)} at 9:30 AM`;
            }
        }

        // Update immediately and then every second
        updateWidget();
        setInterval(updateWidget, 1000);
    </script>
</body>
</html>
